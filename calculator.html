<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feet Inch Calculator - DetailerTools.com</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
    
    <style>
        /* Calculator Specific Styles - Matching Reference Layout */
        :root {
            /* Balanced Theme */
            --bg-app: #1a1a1a;
            --bg-panel: #2a2a2a;
            --bg-display: #333333;
            --text-main: #ffffff;
            --text-muted: #cccccc;
            --text-history: #dddddd;
            
            /* Button Colors */
            --color-feet-bg: #3a6db0;
            --color-inch-bg: #4a8a4a;
            --color-frac-bg: #2a7a7a;
            --color-op-bg: #d67a2a;
            --color-action-bg: #4a5a6a;
            --color-danger: #b03a3a;
            --color-success: #3a8a3a;
            --color-result: #4a9c4a;
            
            /* Accuracy Colors */
            --color-accuracy-16: #3a6db0;
            --color-accuracy-32: #4a8a4a;
            --color-accuracy-64: #2a7a7a;
            --color-accuracy-128: #d67a2a;
            
            --btn-radius: 4px;
            --gap: 4px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #2a2a2a 100%);
            color: var(--text-main);
            min-height: 100vh;
        }

        /* Calculator Container - Match Reference Layout */
        .calculator-wrapper {
            width: 100%;
            max-width: 460px;
            background-color: var(--bg-panel);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            gap: var(--gap);
            padding: 8px; /* Reduced padding */
            margin: 0 auto;
        }

        /* --- DISPLAY SECTION --- */
        .display-container {
            background-color: var(--bg-display);
            border-radius: 6px;
            padding: 6px; /* Reduced */
            text-align: right;
            border: 1px solid #444444;
            min-height: 100px; /* Reduced */
            display: flex;
            flex-direction: column;
        }

        .history-container {
            height: 55px; /* Reduced */
            overflow-y: auto;
            margin-bottom: 5px; /* Reduced */
            padding-right: 4px;
        }

        .history-line {
            font-size: 0.7rem;
            color: var(--text-history);
            margin-bottom: 2px;
            line-height: 1.2;
            text-align: left;
            word-break: break-word;
            padding: 1px 0;
        }

        .history-line:last-child {
            margin-bottom: 0;
        }

        .main-display {
            font-size: 1.7rem; /* Reduced */
            font-weight: 600;
            color: var(--text-main);
            height: 36px; /* Reduced */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            transition: all 0.3s ease;
            border-bottom: 1px solid #444444;
            padding-bottom: 3px; /* Reduced */
            margin-bottom: 3px; /* Reduced */
        }

        .main-display.result {
            color: var(--color-result);
        }

        .sub-display {
            font-size: 0.72rem; /* Reduced */
            color: var(--text-muted);
            min-height: 16px; /* Reduced */
            font-weight: 500;
        }

        .history-container::-webkit-scrollbar {
            width: 4px;
        }

        .history-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 2px;
        }

        .history-container::-webkit-scrollbar-thumb {
            background: var(--color-op-bg);
            border-radius: 2px;
            opacity: 0.7;
        }

        /* --- TABS --- */
        .tabs {
            display: flex;
            gap: 3px;
            background: #3a3a3a;
            padding: 3px;
            border-radius: 4px;
            margin-bottom: 5px; /* Reduced */
        }

        .tab-btn {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-muted);
            padding: 5px 3px; /* Reduced */
            font-weight: 500;
            cursor: pointer;
            border-radius: 3px;
            transition: all 0.2s;
            font-size: 0.78rem; /* Reduced */
            white-space: nowrap;
        }

        .tab-btn.active {
            background-color: var(--color-feet-bg);
            color: white;
        }
        
        /* --- PANEL VISIBILITY --- */
        .panel {
            display: none;
        }

        .panel.active {
            display: block;
        }

        /* --- DUAL KEYPADS with SMALLER BUTTONS --- */
        .dual-keypad-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--gap);
            margin-bottom: var(--gap);
        }

        .pad-section {
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            padding: 5px; /* Reduced */
            border: 1px solid rgba(255,255,255,0.1);
        }

        .pad-header {
            text-align: center;
            font-size: 0.72rem; /* Reduced */
            font-weight: 600;
            margin-bottom: 4px;
        }

        .lbl-ft { color: #8bb5ff; }
        .lbl-in { color: #9ccc9c; }

        /* SMALLER BUTTONS */
        .num-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 3px; /* Reduced */
        }

        button.btn {
            border: none;
            border-radius: var(--btn-radius);
            font-size: 0.88rem; /* Reduced */
            font-weight: 500;
            color: white;
            padding: 6px 0; /* Reduced from 8px */
            cursor: pointer;
            transition: all 0.15s;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
            user-select: none;
            -webkit-user-select: none;
            min-height: 30px; /* Reduced from 36px */
        }
        
        button.btn:hover {
            filter: brightness(1.1);
        }
        
        button.btn:active { 
            transform: translateY(1px); 
            box-shadow: none; 
            filter: brightness(0.9);
        }

        .btn-ft { 
            background-color: var(--color-feet-bg); 
            border: 1px solid rgba(255,255,255,0.1);
        }
        .btn-in { 
            background-color: var(--color-inch-bg); 
            border: 1px solid rgba(255,255,255,0.1);
        }
        .btn-frac { 
            background-color: var(--color-frac-bg); 
            font-size: 0.7rem; /* Reduced */
            padding: 5px 0; /* Reduced */
            min-height: 28px; /* Reduced */
            border: 1px solid rgba(255,255,255,0.1);
        }
        .btn-op { 
            background-color: var(--color-op-bg); 
            color: #FFF; 
            font-size: 0.95rem; /* Reduced */
            padding: 6px 0; /* Reduced */
        }
        .btn-act { 
            background-color: var(--color-action-bg); 
            font-size: 0.7rem; /* Reduced */
            padding: 6px 0; /* Reduced */
        }
        .btn-danger { 
            background-color: var(--color-danger); 
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .btn-wide { grid-column: span 2; }
        
        /* Fractions Section */
        .frac-section {
            background: rgba(255,255,255,0.05);
            padding: 6px;
            border-radius: 6px;
            margin-bottom: var(--gap);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .frac-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 3px; /* Reduced */
            margin-top: 6px;
        }

        /* Custom Fraction Input */
        .custom-frac-row {
            display: flex;
            gap: 4px;
            margin-bottom: 5px;
        }
        
        .custom-frac-input {
            flex: 1;
            background: #3a3a3a;
            border: 1px solid #4a4a4a;
            color: var(--text-main);
            border-radius: 3px;
            padding: 5px 8px; /* Reduced */
            font-size: 0.78rem; /* Reduced */
            text-align: center;
            transition: border-color 0.2s;
        }
        
        .custom-frac-input:focus {
            outline: none;
            border-color: var(--color-frac-bg);
        }
        
        .custom-frac-input::placeholder {
            color: #888888;
        }

        /* === ACCURACY SELECTION === */
        .accuracy-section {
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            padding: 6px;
            margin-bottom: var(--gap);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .accuracy-title {
            text-align: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: #7acccc;
            margin-bottom: 6px;
        }

        .accuracy-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 3px; /* Reduced */
        }

        .btn-accuracy {
            background-color: var(--color-action-bg);
            font-size: 0.7rem; /* Reduced */
            padding: 5px 0; /* Reduced */
            border: 1px solid rgba(255,255,255,0.1);
        }

        .btn-accuracy.active {
            background-color: var(--color-frac-bg);
            font-weight: 600;
        }

        /* === OPERATIONS SECTION === */
        .operations-section {
            background: rgba(255,255,255,0.03);
            border-radius: 6px;
            padding: 6px; /* Reduced */
            margin-bottom: var(--gap);
            border: 2px solid var(--color-op-bg);
            border-left-width: 6px;
        }

        .operations-section-title {
            text-align: center;
            font-size: 0.78rem; /* Reduced */
            font-weight: 600;
            color: var(--color-op-bg);
            margin-bottom: 6px; /* Reduced */
            text-transform: uppercase;
            letter-spacing: 0.5px; /* Reduced */
        }

        /* Operations & Actions Grids */
        .ops-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--gap);
            margin-bottom: var(--gap);
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--gap);
        }

        /* Preview Displays */
        .input-preview {
            background: #3a3a3a;
            color: #FFF;
            text-align: center;
            padding: 4px;
            margin-bottom: 4px;
            border-radius: 3px;
            font-size: 1.0rem; /* Reduced */
            min-height: 26px; /* Reduced */
            border: 1px solid #4a4a4a;
            font-weight: 500;
        }

        /* === DIRECT CONVERSION SECTION === */
        .direct-conversion {
            background: rgba(255,255,255,0.03);
            border-radius: 6px;
            padding: 6px; /* Reduced */
            margin-top: 6px; /* Reduced */
            border: 1px solid rgba(255,255,255,0.1);
        }

        .direct-conversion-title {
            text-align: center;
            font-size: 0.78rem; /* Reduced */
            font-weight: 600;
            color: var(--color-frac-bg);
            margin-bottom: 6px; /* Reduced */
        }

        .conversion-input-row {
            display: flex;
            gap: 4px; /* Reduced */
            margin-bottom: 5px; /* Reduced */
            align-items: center;
        }

        .conversion-input {
            flex: 1;
            background: #3a3a3a;
            border: 1px solid #4a4a4a;
            color: var(--text-main);
            border-radius: 3px;
            padding: 5px 6px; /* Reduced */
            font-size: 0.8rem; /* Reduced */
            text-align: center;
        }

        .conversion-input:focus {
            outline: none;
            border-color: var(--color-frac-bg);
        }

        .unit-select {
            background: #3a3a3a;
            border: 1px solid #4a4a4a;
            color: var(--text-main);
            border-radius: 3px;
            padding: 5px; /* Reduced */
            font-size: 0.72rem; /* Reduced */
            min-width: 55px; /* Reduced */
        }

        .conversion-result {
            background: #3a3a3a;
            border: 1px solid #4a4a4a;
            border-radius: 3px;
            padding: 6px; /* Reduced */
            font-size: 0.8rem; /* Reduced */
            text-align: center;
            min-height: 36px; /* Reduced */
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 5px; /* Reduced */
            color: var(--text-history);
        }

        /* Unit Converter Grid */
        .converter-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--gap);
        }

        /* Normal Calculator */
        .normal-calc-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 3px; /* Reduced */
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 12px; /* Reduced */
            left: 50%;
            transform: translateX(-50%);
            background: var(--color-success);
            color: white;
            padding: 6px 12px; /* Reduced */
            border-radius: 3px;
            z-index: 1000;
            animation: slideDown 0.3s ease;
            box-shadow: 0 3px 8px rgba(0,0,0,0.3);
            font-weight: 500;
            font-size: 0.8rem; /* Reduced */
            max-width: 90%;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translate(-50%, -12px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }

        /* Make equals button more prominent */
        .btn-equals {
            background-color: var(--color-success);
            font-weight: 600;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn-equals:hover {
            filter: brightness(1.1);
        }

        .keyboard-hint {
            color: var(--text-muted);
            font-size: 0.62rem; /* Reduced */
            text-align: center;
            margin-top: 5px; /* Reduced */
            padding-top: 5px; /* Reduced */
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .footer-info {
            color: #777777;
            font-size: 0.58rem; /* Reduced */
            text-align: center;
            margin-top: 2px;
        }

        /* Page Title Section */
        .page-title-section {
            text-align: center;
            margin-bottom: 2rem;
        }

        .page-title-section h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #76b900 0%, #8bc34a 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 20px rgba(118, 185, 0, 0.3);
        }

        .page-title-section p {
            color: #9ca3af;
            font-size: 1.1rem;
        }

        /* Calculator Container Integration */
        .calculator-page-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .calculator-content {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .calculator-main {
            flex: 1;
            min-width: 300px;
            max-width: 500px;
        }

        .calculator-sidebar {
            flex: 0 0 300px;
        }

        /* Info Cards */
        .info-card {
            background: rgba(30, 30, 30, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }

        .info-card:hover {
            transform: translateY(-2px);
            border-color: rgba(118, 185, 0, 0.3);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .info-card h3 {
            color: #76b900;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .info-card p, .info-card li {
            color: #d1d5db;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .info-card ul {
            list-style: none;
            padding: 0;
        }

        .info-card li {
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .info-card li:last-child {
            border-bottom: none;
        }

        .info-card li::before {
            content: '→';
            color: #76b900;
            margin-right: 0.5rem;
            font-weight: bold;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .calculator-content {
                flex-direction: column;
                align-items: center;
            }

            .calculator-sidebar {
                flex: 1;
                width: 100%;
                max-width: 500px;
            }

            .page-title-section h1 {
                font-size: 2rem;
            }

            .calculator-page-container {
                padding: 1rem 0.5rem;
            }
        }
    </style>
</head>
<body class="text-white">
    <!-- Navigation -->
    <nav class="dark-glass sticky top-0 z-50 border-b border-gray-800">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-8">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 nvidia-gradient rounded-lg flex items-center justify-center">
                            <i data-lucide="calculator" class="h-6 w-6 text-white"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold glow-text">DetailerTools.com</h1>
                            <p class="text-xs text-gray-400">Professional Tekla Detailer Suite</p>
                        </div>
                    </div>
                    
                    <div class="hidden md:flex items-center space-x-6">
                        <a href="index.html" class="nav-link text-gray-300 hover:text-white font-medium">
                            Home
                        </a>
                        <a href="checker.html" class="nav-link text-gray-300 hover:text-white font-medium">
                            Word Checker
                        </a>
                        <a href="calculator.html" class="nav-link active text-gray-300 hover:text-white font-medium">
                            Calculator
                        </a>
                        <a href="blog.html" class="nav-link text-gray-300 hover:text-white font-medium">
                            Blog
                        </a>
                        <a href="forum.html" class="nav-link text-gray-300 hover:text-white font-medium">
                            Forum
                        </a>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Search Bar -->
                    <div class="relative">
                        <input type="text" id="searchInput" placeholder="Search..." class="bg-gray-800 text-white px-4 py-2 pr-10 rounded-lg focus:outline-none focus:border-green-500 border border-gray-700">
                        <button onclick="performSearch(document.getElementById('searchInput').value)" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white">
                            <i data-lucide="search" class="h-4 w-4"></i>
                        </button>
                    </div>
                    
                    <!-- Auth -->
                    <button id="loginBtn" onclick="showLoginModal()" class="p-2 rounded-lg hover:bg-gray-800 transition-colors">
                        <i data-lucide="user" class="h-5 w-5"></i>
                    </button>
                    <button id="logoutBtn" onclick="logout()" style="display: none;" class="p-2 rounded-lg hover:bg-gray-800 transition-colors">
                        <i data-lucide="log-out" class="h-5 w-5"></i>
                    </button>
                    <span id="userDisplay" class="text-sm text-gray-400">Guest</span>
                    
                    <!-- Notifications -->
                    <button class="p-2 rounded-lg hover:bg-gray-800 transition-colors">
                        <i data-lucide="bell" class="h-5 w-5"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile Navigation -->
    <div class="md:hidden dark-glass border-b border-gray-800">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div class="flex justify-around">
                <a href="index.html" class="nav-link text-gray-300 hover:text-white font-medium text-sm">
                    <i data-lucide="home" class="h-4 w-4 mx-auto mb-1"></i>
                    Home
                </a>
                <a href="checker.html" class="nav-link text-gray-300 hover:text-white font-medium text-sm">
                    <i data-lucide="search" class="h-4 w-4 mx-auto mb-1"></i>
                    Checker
                </a>
                <a href="calculator.html" class="nav-link active text-gray-300 hover:text-white font-medium text-sm">
                    <i data-lucide="calculator" class="h-4 w-4 mx-auto mb-1"></i>
                    Calc
                </a>
                <a href="blog.html" class="nav-link text-gray-300 hover:text-white font-medium text-sm">
                    <i data-lucide="file-text" class="h-4 w-4 mx-auto mb-1"></i>
                    Blog
                </a>
                <a href="forum.html" class="nav-link text-gray-300 hover:text-white font-medium text-sm">
                    <i data-lucide="message-circle" class="h-4 w-4 mx-auto mb-1"></i>
                    Forum
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="calculator-page-container">
        <!-- Page Title -->
        <div class="page-title-section">
            <h1>Feet Inch Calculator</h1>
            <p>Professional construction calculations with precise fraction support</p>
        </div>

        <div class="calculator-content">
            <!-- Calculator Main -->
            <div class="calculator-main">
                <div class="calculator-wrapper">
                    <!-- Display Section -->
                    <div class="display-container">
                        <!-- History Container with Fixed Height -->
                        <div class="history-container" id="historyContainer">
                            <!-- History lines will be inserted here by JavaScript -->
                        </div>
                        
                        <!-- Main Display -->
                        <div class="main-display" id="display">0' 0"</div>
                        <div class="sub-display" id="subDisplay">0.0000 ft</div>
                    </div>

                    <!-- Tabs -->
                    <div class="tabs">
                        <button class="tab-btn active" onclick="switchMode('feet-inch')">Feet-Inch</button>
                        <button class="tab-btn" onclick="switchMode('normal')">Normal</button>
                        <button class="tab-btn" onclick="switchMode('convert')">Convert</button>
                    </div>

                    <!-- === MODE: FEET-INCH === -->
                    <div id="panel-feet-inch" class="panel active">
                        
                        <!-- Dual Keypads -->
                        <div class="dual-keypad-row">
                            <!-- FEET -->
                            <div class="pad-section">
                                <div class="pad-header lbl-ft">FEET</div>
                                <div class="input-preview" id="previewFeet">0</div>
                                <div class="num-grid">
                                    <button class="btn btn-ft" onclick="fi.appendFeet(7)">7</button>
                                    <button class="btn btn-ft" onclick="fi.appendFeet(8)">8</button>
                                    <button class="btn btn-ft" onclick="fi.appendFeet(9)">9</button>
                                    <button class="btn btn-ft" onclick="fi.appendFeet(4)">4</button>
                                    <button class="btn btn-ft" onclick="fi.appendFeet(5)">5</button>
                                    <button class="btn btn-ft" onclick="fi.appendFeet(6)">6</button>
                                    <button class="btn btn-ft" onclick="fi.appendFeet(1)">1</button>
                                    <button class="btn btn-ft" onclick="fi.appendFeet(2)">2</button>
                                    <button class="btn btn-ft" onclick="fi.appendFeet(3)">3</button>
                                    <button class="btn btn-danger" onclick="fi.clearFeet()">C</button>
                                    <button class="btn btn-ft" onclick="fi.appendFeet(0)">0</button>
                                    <button class="btn btn-danger" onclick="fi.backspaceFeet()">⌫</button>
                                </div>
                            </div>

                            <!-- INCHES -->
                            <div class="pad-section">
                                <div class="pad-header lbl-in">INCHES</div>
                                <div class="input-preview" id="previewInch">0</div>
                                <div class="num-grid">
                                    <button class="btn btn-in" onclick="fi.appendInch(7)">7</button>
                                    <button class="btn btn-in" onclick="fi.appendInch(8)">8</button>
                                    <button class="btn btn-in" onclick="fi.appendInch(9)">9</button>
                                    <button class="btn btn-in" onclick="fi.appendInch(4)">4</button>
                                    <button class="btn btn-in" onclick="fi.appendInch(5)">5</button>
                                    <button class="btn btn-in" onclick="fi.appendInch(6)">6</button>
                                    <button class="btn btn-in" onclick="fi.appendInch(1)">1</button>
                                    <button class="btn btn-in" onclick="fi.appendInch(2)">2</button>
                                    <button class="btn btn-in" onclick="fi.appendInch(3)">3</button>
                                    <button class="btn btn-danger" onclick="fi.clearInch()">C</button>
                                    <button class="btn btn-in" onclick="fi.appendInch(0)">0</button>
                                    <button class="btn btn-danger" onclick="fi.backspaceInch()">⌫</button>
                                </div>
                            </div>
                        </div>

                        <!-- Fractions Section -->
                        <div class="frac-section">
                            <div class="pad-header" style="color:#7acccc">FRACTIONS</div>
                            
                            <div class="custom-frac-row">
                                <input type="text" id="customFrac" class="custom-frac-input" 
                                       placeholder="Fraction (5/32) or decimal (0.125)"
                                       onkeydown="handleCustomFractionKeydown(event)"
                                       onkeypress="handleCustomFractionKeypress(event)">
                                <button class="btn btn-act" onclick="fi.applyCustomFrac()">Set</button>
                            </div>

                            <div class="frac-grid">
                                <button class="btn btn-frac" onclick="fi.setFrac(1,16)">1/16</button>
                                <button class="btn btn-frac" onclick="fi.setFrac(1,8)">1/8</button>
                                <button class="btn btn-frac" onclick="fi.setFrac(3,16)">3/16</button>
                                <button class="btn btn-frac" onclick="fi.setFrac(1,4)">1/4</button>

                                <button class="btn btn-frac" onclick="fi.setFrac(5,16)">5/16</button>
                                <button class="btn btn-frac" onclick="fi.setFrac(3,8)">3/8</button>
                                <button class="btn btn-frac" onclick="fi.setFrac(7,16)">7/16</button>
                                <button class="btn btn-frac" onclick="fi.setFrac(1,2)">1/2</button>

                                <button class="btn btn-frac" onclick="fi.setFrac(9,16)">9/16</button>
                                <button class="btn btn-frac" onclick="fi.setFrac(5,8)">5/8</button>
                                <button class="btn btn-frac" onclick="fi.setFrac(11,16)">11/16</button>
                                <button class="btn btn-frac" onclick="fi.setFrac(3,4)">3/4</button>
                                
                                <button class="btn btn-frac" onclick="fi.setFrac(13,16)">13/16</button>
                                <button class="btn btn-frac" onclick="fi.setFrac(7,8)">7/8</button>
                                <button class="btn btn-frac" onclick="fi.setFrac(15,16)">15/16</button>
                                <button class="btn btn-danger" onclick="fi.clearFrac()">CLR</button>
                            </div>
                        </div>
                    </div>

                    <!-- === MODE: NORMAL === -->
                    <div id="panel-normal" class="panel">
                        <div class="normal-calc-grid">
                            <button class="btn btn-act" onclick="norm.clear()">AC</button>
                            <button class="btn btn-act" onclick="norm.backspace()">⌫</button>
                            <button class="btn btn-act" onclick="norm.toggleSign()">+/-</button>
                            <button class="btn btn-op" onclick="norm.setOp('/')">÷</button>

                            <button class="btn btn-act" onclick="norm.append('7')">7</button>
                            <button class="btn btn-act" onclick="norm.append('8')">8</button>
                            <button class="btn btn-act" onclick="norm.append('9')">9</button>
                            <button class="btn btn-op" onclick="norm.setOp('*')">×</button>

                            <button class="btn btn-act" onclick="norm.append('4')">4</button>
                            <button class="btn btn-act" onclick="norm.append('5')">5</button>
                            <button class="btn btn-act" onclick="norm.append('6')">6</button>
                            <button class="btn btn-op" onclick="norm.setOp('-')">-</button>

                            <button class="btn btn-act" onclick="norm.append('1')">1</button>
                            <button class="btn btn-act" onclick="norm.append('2')">2</button>
                            <button class="btn btn-act" onclick="norm.append('3')">3</button>
                            <button class="btn btn-op" onclick="norm.setOp('+')">+</button>

                            <button class="btn btn-act btn-wide" onclick="norm.append('0')">0</button>
                            <button class="btn btn-act" onclick="norm.append('.')">.</button>
                            <button class="btn btn-op" onclick="norm.calc()">=</button>
                        </div>
                    </div>

                    <!-- === MODE: CONVERT === -->
                    <div id="panel-convert" class="panel">
                        <div class="pad-section">
                            <div class="pad-header">CONVERT CURRENT VALUE</div>
                            <div class="converter-grid">
                                <button class="btn btn-act" onclick="conv.toMM()">To mm</button>
                                <button class="btn btn-act" onclick="conv.toCM()">To cm</button>
                                <button class="btn btn-act" onclick="conv.toM()">To Meter</button>
                                <button class="btn btn-act" onclick="conv.toFIF()">To F-I-F</button>
                            </div>
                            <div style="margin-top:6px; text-align:center; color:#888; font-size:0.72rem;">
                                Converts the value on main display
                            </div>
                        </div>

                        <!-- Direct Conversion Section -->
                        <div class="direct-conversion">
                            <div class="direct-conversion-title">DIRECT CONVERSION</div>
                            
                            <div class="conversion-input-row">
                                <input type="text" class="conversion-input" id="directValue" placeholder="Enter value">
                                <select class="unit-select" id="fromUnit">
                                    <option value="mm">mm</option>
                                    <option value="cm">cm</option>
                                    <option value="m">m</option>
                                    <option value="ft">ft</option>
                                    <option value="in">in</option>
                                    <option value="fif">F-I-F</option>
                                </select>
                                <span style="color:#888; font-size:0.75rem;">to</span>
                                <select class="unit-select" id="toUnit">
                                    <option value="fif">F-I-F</option>
                                    <option value="mm">mm</option>
                                    <option value="cm">cm</option>
                                    <option value="m">m</option>
                                    <option value="ft">ft</option>
                                    <option value="in">in</option>
                                </select>
                                <button class="btn btn-act" onclick="conv.directConvert()" style="padding:5px 8px;">Convert</button>
                            </div>
                            
                            <div class="conversion-result" id="directResult">
                                Enter value and select units
                            </div>
                        </div>
                    </div>

                    <!-- === ACCURACY SELECTION === -->
                    <div class="accuracy-section">
                        <div class="accuracy-title">ACCURACY</div>
                        <div class="accuracy-grid">
                            <button class="btn btn-accuracy" id="acc16" onclick="setAccuracy(16)">1/16</button>
                            <button class="btn btn-accuracy" id="acc32" onclick="setAccuracy(32)">1/32</button>
                            <button class="btn btn-accuracy" id="acc64" onclick="setAccuracy(64)">1/64</button>
                            <button class="btn btn-accuracy active" id="acc128" onclick="setAccuracy(128)">1/128</button>
                        </div>
                    </div>

                    <!-- === OPERATIONS SECTION === -->
                    <div class="operations-section">
                        <div class="operations-section-title">Operations</div>
                        
                        <!-- OPERATIONS GRID -->
                        <div class="ops-grid">
                            <button class="btn btn-op" onclick="shared.setOp('+')">+</button>
                            <button class="btn btn-op" onclick="shared.setOp('-')">-</button>
                            <button class="btn btn-op" onclick="shared.setOp('*')">×</button>
                            <button class="btn btn-op" onclick="shared.setOp('/')">÷</button>
                            
                            <button class="btn btn-op btn-equals" style="grid-column: span 2;" 
                                    onclick="shared.calculate()">=</button>
                            <button class="btn btn-op" onclick="fi.toggleSign()">+/-</button>
                            <button class="btn btn-op" onclick="fi.convertToDecimal()">Dec</button>
                        </div>

                        <!-- ACTIONS GRID -->
                        <div class="actions-grid">
                            <button class="btn btn-act" onclick="mem.recall()">MR</button>
                            <button class="btn btn-act" onclick="mem.clear()">MC</button>
                            <button class="btn btn-act" onclick="mem.add()">M+</button>
                            <button class="btn btn-act" onclick="mem.sub()">M-</button>
                            
                            <button class="btn btn-danger" onclick="shared.clearEntry()">CE</button>
                            <button class="btn btn-danger" onclick="shared.clearAll()">AC</button>
                            <button class="btn btn-act" onclick="shared.copy()">Copy</button>
                            <button class="btn btn-act" onclick="shared.undo()">Undo</button>
                        </div>
                    </div>

                    <div class="keyboard-hint">
                        Click buttons to input values | + - * /, Enter(=), Backspace, C(clear)
                    </div>
                    
                    <div class="footer-info">
                        Construction Calculator v2.4 | Accuracy: 1/128
                    </div>
                </div>
            </div>

            <!-- Calculator Sidebar -->
            <div class="calculator-sidebar">
                <!-- Features Card -->
                <div class="info-card">
                    <h3>
                        <i data-lucide="star" class="h-5 w-5"></i>
                        Key Features
                    </h3>
                    <ul>
                        <li>Dual keypad for feet & inches</li>
                        <li>Precision fraction support (1/16 to 1/128)</li>
                        <li>Memory functions (M+, M-, MR, MC)</li>
                        <li>Unit conversions (mm, cm, m, decimal)</li>
                        <li>Calculation history tracking</li>
                        <li>Keyboard input support</li>
                    </ul>
                </div>

                <!-- Usage Tips Card -->
                <div class="info-card">
                    <h3>
                        <i data-lucide="help-circle" class="h-5 w-5"></i>
                        Usage Tips
                    </h3>
                    <ul>
                        <li>Use separate keypads for feet and inches</li>
                        <li>Select common fractions or enter custom ones</li>
                        <li>Adjust accuracy for different precision needs</li>
                        <li>Switch between display modes (F-I-F, decimal, metric)</li>
                        <li>Use keyboard for faster input</li>
                    </ul>
                </div>

                <!-- Quick Reference Card -->
                <div class="info-card">
                    <h3>
                        <i data-lucide="book-open" class="h-5 w-5"></i>
                        Quick Reference
                    </h3>
                    <ul>
                        <li>1 foot = 12 inches</li>
                        <li>1 inch = 25.4 mm</li>
                        <li>Common fractions: 1/8, 1/4, 1/2, 3/4</li>
                        <li>Memory stores last calculated value</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="dark-glass border-t border-gray-800 mt-16">
        <div class="max-w-7xl mx-auto px-4 py-8">
            <div class="grid md:grid-cols-4 gap-8">
                <div>
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="w-8 h-8 nvidia-gradient rounded-lg flex items-center justify-center">
                            <i data-lucide="tool" class="h-4 w-4 text-white"></i>
                        </div>
                        <h3 class="text-lg font-bold">DetailerTools.com</h3>
                    </div>
                    <p class="text-sm text-gray-400">Professional Tekla detailer tools suite built by detailers, for detailers.</p>
                </div>
                
                <div>
                    <h4 class="font-semibold mb-4">Tools</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li><a href="checker.html" class="hover:text-white transition-colors">Word Checker</a></li>
                        <li><a href="calculator.html" class="hover:text-white transition-colors">Feet Inch Calc</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="font-semibold mb-4">Community</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li><a href="blog.html" class="hover:text-white transition-colors">Blog</a></li>
                        <li><a href="forum.html" class="hover:text-white transition-colors">Forum</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="font-semibold mb-4">Connect</h4>
                    <div class="flex space-x-4">
                        <button class="p-2 rounded-lg hover:bg-gray-800 transition-colors">
                            <i data-lucide="github" class="h-5 w-5"></i>
                        </button>
                        <button class="p-2 rounded-lg hover:bg-gray-800 transition-colors">
                            <i data-lucide="linkedin" class="h-5 w-5"></i>
                        </button>
                        <button class="p-2 rounded-lg hover:bg-gray-800 transition-colors">
                            <!-- X.com icon -->
                            <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M18.244 2.25h3.308l-2.393 7.724h-2.906l-2.393-7.724h-3.308c-1.4 0-2.314.617-2.314 1.374v5.882c0 .757.914 1.374 2.314 1.374h1.146v3.219h-1.146c-1.933 0-3.464-1.567-3.464-3.5v-5.882c0-1.933 1.531-3.5 3.464-3.5h1.146v-3.219z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-gray-800 mt-8 pt-8 text-center text-sm text-gray-400">
                <p>© 2024 DetailerTools.com. Built with passion for Tekla Steel Detailers.</p>
            </div>
        </div>
    </footer>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="nvidia-card rounded-xl p-8 max-w-md w-full mx-4">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-semibold">Login to DetailerTools</h3>
                <button onclick="hideLoginModal()" class="text-gray-400 hover:text-white">
                    <i data-lucide="x" class="h-6 w-6"></i>
                </button>
            </div>
            
            <form onsubmit="handleLogin(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Email</label>
                    <input type="email" required class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-green-500" placeholder="your@email.com">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Password</label>
                    <input type="password" required class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-green-500" placeholder="••••••••••">
                </div>
                <button type="submit" class="w-full nvidia-button py-3 rounded-lg text-white font-semibold">
                    Login
                </button>
            </form>
        </div>
    </div>

<script>
    // --- STATE MANAGEMENT ---
    const STATE = {
        mode: 'feet-inch',
        currentDisplayUnit: 'inches',
        lastResult: null,
        accuracy: 128, // 16, 32, 64, or 128
        
        // Feet-Inch State
        fi: {
            feet: 0,
            inch: 0,
            fracNum: 0,
            fracDen: 1,
            isNeg: false,
            storedVal: null,
            op: null,
            isNewEntry: true,
        },

        // Normal State
        norm: {
            current: '0',
            stored: null,
            op: null,
            isNewEntry: true
        },

        memory: 0,
        undoStack: [],
        calcHistory: [],
        keyDebounce: {}
    };

    // DOM Elements
    const els = {
        display: document.getElementById('display'),
        subDisplay: document.getElementById('subDisplay'),
        historyContainer: document.getElementById('historyContainer'),
        previewFeet: document.getElementById('previewFeet'),
        previewInch: document.getElementById('previewInch'),
        customFrac: document.getElementById('customFrac'),
        directValue: document.getElementById('directValue'),
        fromUnit: document.getElementById('fromUnit'),
        toUnit: document.getElementById('toUnit'),
        directResult: document.getElementById('directResult'),
        panels: {
            'feet-inch': document.getElementById('panel-feet-inch'),
            'normal': document.getElementById('panel-normal'),
            'convert': document.getElementById('panel-convert')
        },
        tabs: document.querySelectorAll('.tab-btn'),
        accuracyButtons: {
            16: document.getElementById('acc16'),
            32: document.getElementById('acc32'),
            64: document.getElementById('acc64'),
            128: document.getElementById('acc128')
        }
    };

    // --- UTILITY FUNCTIONS ---
    const gcd = (a, b) => b ? gcd(b, a % b) : a;

    function showToast(message, duration = 1800) {
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.textContent = message;
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.style.opacity = '0';
            toast.style.transform = 'translate(-50%, -8px)';
            setTimeout(() => document.body.removeChild(toast), 300);
        }, duration);
    }

    function debounce(func, wait = 80) {
        return function(...args) {
            const key = func.name || 'default';
            if (STATE.keyDebounce[key]) return;
            
            STATE.keyDebounce[key] = true;
            func.apply(this, args);
            
            setTimeout(() => {
                STATE.keyDebounce[key] = false;
            }, wait);
        };
    }

    // --- HISTORY MANAGEMENT ---
    function updateHistoryDisplay() {
        const container = els.historyContainer;
        container.innerHTML = '';
        
        if (STATE.calcHistory.length === 0) {
            const line = document.createElement('div');
            line.className = 'history-line';
            line.textContent = 'Ready';
            line.style.color = '#777';
            line.style.fontStyle = 'italic';
            container.appendChild(line);
            return;
        }
        
        // Show all history entries, most recent at bottom
        STATE.calcHistory.forEach(item => {
            const line = document.createElement('div');
            line.className = 'history-line';
            line.textContent = item;
            container.appendChild(line);
        });
        
        // Scroll to bottom to show most recent
        container.scrollTop = container.scrollHeight;
    }

    function addToHistory(entry) {
        STATE.calcHistory.push(entry);
        // Keep only last 15 entries to prevent memory issues
        if (STATE.calcHistory.length > 15) {
            STATE.calcHistory.shift();
        }
        updateHistoryDisplay();
    }

    function saveState() {
        if (STATE.mode === 'feet-inch') {
            STATE.undoStack.push({
                feet: STATE.fi.feet,
                inch: STATE.fi.inch,
                fracNum: STATE.fi.fracNum,
                fracDen: STATE.fi.fracDen,
                isNeg: STATE.fi.isNeg
            });
            if (STATE.undoStack.length > 15) STATE.undoStack.shift();
        }
    }

    // --- ACCURACY MANAGEMENT ---
    function setAccuracy(denominator) {
        STATE.accuracy = denominator;
        
        // Update button states
        Object.keys(els.accuracyButtons).forEach(den => {
            els.accuracyButtons[den].classList.remove('active');
        });
        els.accuracyButtons[denominator].classList.add('active');
        
        // Update footer info
        document.querySelector('.footer-info').textContent = 
            `Construction Calculator v2.4 | Accuracy: 1/${denominator}`;
        
        // Recalculate current display with new accuracy
        if (STATE.mode === 'feet-inch' || STATE.mode === 'convert') {
            fi.updateDisplay();
        }
        
        showToast(`Accuracy set to 1/${denominator}`);
    }

    // --- MODE MANAGEMENT ---
    function switchMode(mode) {
        STATE.mode = mode;
        
        // Update tabs
        els.tabs.forEach(t => t.classList.remove('active'));
        const activeTab = Array.from(els.tabs).find(t => 
            t.textContent.toLowerCase().includes(mode.split('-')[0])
        );
        if (activeTab) activeTab.classList.add('active');

        // Update panels
        Object.keys(els.panels).forEach(k => {
            els.panels[k].classList[k === mode ? 'add' : 'remove']('active');
        });

        // Update display
        if (mode === 'feet-inch' || mode === 'convert') fi.updateDisplay();
        else if (mode === 'normal') norm.updateDisplay();
        
        updateHistoryDisplay();
    }

    // --- CUSTOM FRACTION INPUT HANDLING ---
    function handleCustomFractionKeydown(event) {
        // Allow: backspace, delete, tab, escape, enter, slash (/)
        if ([46, 8, 9, 27, 13, 110, 190, 191].includes(event.keyCode) ||
            // Allow: Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X
            (event.ctrlKey && [65, 67, 86, 88].includes(event.keyCode)) ||
            // Allow: home, end, left, right
            (event.keyCode >= 35 && event.keyCode <= 39)) {
            return;
        }
        
        // Allow numbers and slash
        if ((event.keyCode >= 48 && event.keyCode <= 57) || // number keys
            (event.keyCode >= 96 && event.keyCode <= 105) || // numpad
            event.keyCode === 111 || // numpad slash
            event.keyCode === 191) { // regular slash
            return;
        }
        
        // Prevent decimal point if we already have a fraction
        if (event.keyCode === 190 || event.keyCode === 110) { // decimal point
            const input = event.target.value;
            if (input.includes('/')) {
                event.preventDefault();
                return;
            }
        }
        
        event.preventDefault();
    }

    function handleCustomFractionKeypress(event) {
        // Allow Enter to submit
        if (event.key === 'Enter') {
            fi.applyCustomFrac();
        }
    }

    // --- FEET-INCH LOGIC ---
    const fi = {
        resetInput: () => {
            STATE.fi.feet = 0;
            STATE.fi.inch = 0;
            STATE.fi.fracNum = 0;
            STATE.fi.fracDen = 1;
            STATE.fi.isNeg = false;
        },

        checkNewEntry: () => {
            if (STATE.fi.isNewEntry) {
                fi.resetInput();
                STATE.fi.isNewEntry = false;
            }
            if (STATE.currentDisplayUnit !== 'inches') {
                STATE.currentDisplayUnit = 'inches';
            }
        },

        appendFeet: debounce(function(n) {
            saveState();
            fi.checkNewEntry();
            // Prevent overflow
            if (STATE.fi.feet.toString().length >= 4) {
                showToast("Feet value too large");
                return;
            }
            const str = STATE.fi.feet.toString() + n.toString();
            STATE.fi.feet = parseInt(str) || 0;
            fi.updateDisplay();
        }),

        appendInch: debounce(function(n) {
            saveState();
            fi.checkNewEntry();
            // Prevent overflow
            if (STATE.fi.inch.toString().length >= 3) {
                showToast("Inches value too large");
                return;
            }
            const str = STATE.fi.inch.toString() + n.toString();
            STATE.fi.inch = parseInt(str) || 0;
            fi.updateDisplay();
        }),

        setFrac: (n, d) => {
            saveState();
            fi.checkNewEntry();
            STATE.fi.fracNum = n;
            STATE.fi.fracDen = d;
            fi.updateDisplay();
        },

        applyCustomFrac: () => {
            const val = els.customFrac.value.trim();
            if (!val) return;
            
            try {
                // Check if it's a decimal
                if (val.includes('.') || (!val.includes('/') && !isNaN(val))) {
                    const decimal = parseFloat(val);
                    if (isNaN(decimal)) throw new Error("Invalid number");
                    
                    // Convert decimal to simplest fraction based on current accuracy
                    const tolerance = 1.0E-6;
                    let h1 = 1, h2 = 0, k1 = 0, k2 = 1;
                    let b = decimal;
                    let steps = 0;
                    
                    do {
                        const a = Math.floor(b);
                        let aux = h1;
                        h1 = a * h1 + h2;
                        h2 = aux;
                        aux = k1;
                        k1 = a * k1 + k2;
                        k2 = aux;
                        b = 1 / (b - a);
                        steps++;
                    } while (Math.abs(decimal - h1/k1) > decimal * tolerance && steps < 10 && k1 <= STATE.accuracy);
                    
                    STATE.fi.fracNum = h1;
                    STATE.fi.fracDen = k1;
                    
                } else if (val.includes('/')) {
                    // Handle fraction input
                    const parts = val.split('/');
                    const num = parseInt(parts[0]);
                    const den = parseInt(parts[1]);
                    
                    if (isNaN(num) || isNaN(den) || den <= 0) {
                        throw new Error("Invalid fraction");
                    }
                    
                    STATE.fi.fracNum = num;
                    STATE.fi.fracDen = den;
                } else {
                    throw new Error("Invalid input");
                }
                
                els.customFrac.value = '';
                fi.updateDisplay();
                
            } catch (err) {
                showToast(err.message);
            }
        },

        clearFeet: () => { saveState(); STATE.fi.feet = 0; fi.updateDisplay(); },
        clearInch: () => { saveState(); STATE.fi.inch = 0; fi.updateDisplay(); },
        clearFrac: () => { saveState(); STATE.fi.fracNum = 0; STATE.fi.fracDen = 1; fi.updateDisplay(); },
        
        backspaceFeet: () => {
            saveState();
            STATE.fi.feet = Math.floor(STATE.fi.feet / 10);
            fi.updateDisplay();
        },
        
        backspaceInch: () => {
            saveState();
            STATE.fi.inch = Math.floor(STATE.fi.inch / 10);
            fi.updateDisplay();
        },

        toggleSign: () => {
            STATE.fi.isNeg = !STATE.fi.isNeg;
            fi.updateDisplay();
        },

        convertToDecimal: () => {
            STATE.currentDisplayUnit = STATE.currentDisplayUnit === 'decimal' ? 'inches' : 'decimal';
            fi.updateDisplay();
        },

        getTotalInches: () => {
            let inches = (STATE.fi.feet * 12) + STATE.fi.inch + (STATE.fi.fracNum / STATE.fi.fracDen);
            return STATE.fi.isNeg ? -inches : inches;
        },

        setFromTotalInches: (total) => {
            try {
                STATE.fi.isNeg = total < 0;
                const abs = Math.abs(total);
                
                STATE.fi.feet = Math.floor(abs / 12);
                let rem = abs - (STATE.fi.feet * 12);
                STATE.fi.inch = Math.floor(rem);
                
                let frac = rem - STATE.fi.inch;
                // Use current accuracy for rounding
                let numerator = Math.round(frac * STATE.accuracy);

                // Handle carry-over
                if (numerator === STATE.accuracy) {
                    STATE.fi.inch++;
                    numerator = 0;
                }
                if (STATE.fi.inch === 12) {
                    STATE.fi.feet++;
                    STATE.fi.inch = 0;
                }

                if (numerator > 0) {
                    const div = gcd(numerator, STATE.accuracy);
                    STATE.fi.fracNum = numerator / div;
                    STATE.fi.fracDen = STATE.accuracy / div;
                } else {
                    STATE.fi.fracNum = 0;
                    STATE.fi.fracDen = 1;
                }
            } catch (err) {
                showToast("Invalid value conversion");
            }
        },

        updateDisplay: () => {
            const totInches = fi.getTotalInches();
            
            els.previewFeet.textContent = STATE.fi.feet;
            els.previewInch.textContent = STATE.fi.inch;

            let mainText = '';
            let subText = '';

            // Format Feet-Inch-Fraction string
            const fiString = shared.formatFeetInch(totInches, false);

            if (STATE.currentDisplayUnit === 'inches') {
                mainText = fiString;
                subText = `${(totInches/12).toFixed(4)} ft`;

            } else if (STATE.currentDisplayUnit === 'decimal') {
                mainText = (totInches / 12).toFixed(6) + ' ft';
                subText = fiString;

            } else {
                // Metric Display
                const absInches = Math.abs(totInches);
                let metricVal;
                let unitLabel;

                switch(STATE.currentDisplayUnit) {
                    case 'mm': metricVal = absInches * 25.4; unitLabel = 'mm'; break;
                    case 'cm': metricVal = absInches * 2.54; unitLabel = 'cm'; break;
                    case 'm': metricVal = absInches * 0.0254; unitLabel = 'm'; break;
                }
                
                mainText = (STATE.fi.isNeg ? "- " : "") + metricVal.toFixed(4) + ' ' + unitLabel;
                subText = fiString;
            }

            els.display.textContent = mainText;
            els.subDisplay.textContent = subText;
            
            // Highlight result
            if (STATE.lastResult === totInches) {
                els.display.classList.add('result');
            } else {
                els.display.classList.remove('result');
            }
        }
    };

    // --- NORMAL MODE LOGIC ---
    const norm = {
        append: debounce(function(v) {
            if (STATE.norm.isNewEntry) {
                STATE.norm.current = '';
                STATE.norm.isNewEntry = false;
            }
            if (v === '.' && STATE.norm.current.includes('.')) return;
            STATE.norm.current = (STATE.norm.current === '0' && v !== '.') ? v : STATE.norm.current + v;
            norm.updateDisplay();
        }),

        clear: () => {
            STATE.norm.current = '0';
            STATE.norm.stored = null;
            STATE.norm.op = null;
            norm.updateDisplay();
            updateHistoryDisplay();
        },

        setOp: (op) => {
            if (STATE.norm.stored === null) {
                STATE.norm.stored = parseFloat(STATE.norm.current);
            } else if (!STATE.norm.isNewEntry) {
                norm.calcIntermediate();
            }
            STATE.norm.op = op;
            STATE.norm.isNewEntry = true;
        },

        calcIntermediate: () => {
            try {
                const cur = parseFloat(STATE.norm.current);
                const res = shared.doMath(STATE.norm.stored, cur, STATE.norm.op);
                STATE.norm.stored = res;
                STATE.norm.current = res.toString();
            } catch (err) {
                showToast("Calculation error");
            }
        },

        calc: () => {
            if (STATE.norm.op && STATE.norm.stored !== null) {
                try {
                    const valA = STATE.norm.stored;
                    const op = STATE.norm.op;
                    const valB = parseFloat(STATE.norm.current);
                    
                    norm.calcIntermediate();
                    
                    // Add to history
                    addToHistory(`${valA} ${op} ${valB} = ${STATE.norm.current}`);
                    
                    STATE.norm.op = null;
                    STATE.norm.isNewEntry = true;
                    STATE.lastResult = parseFloat(STATE.norm.current);
                    norm.updateDisplay();
                } catch (err) {
                    showToast("Calculation failed");
                }
            }
        },

        backspace: () => {
            STATE.norm.current = STATE.norm.current.slice(0, -1) || '0';
            norm.updateDisplay();
        },

        toggleSign: () => {
            STATE.norm.current = (parseFloat(STATE.norm.current) * -1).toString();
            norm.updateDisplay();
        },

        updateDisplay: () => {
            els.display.textContent = STATE.norm.current;
            els.subDisplay.textContent = 'Normal Calculator';
            
            if (STATE.lastResult === parseFloat(STATE.norm.current)) {
                els.display.classList.add('result');
            } else {
                els.display.classList.remove('result');
            }
        }
    };

    // --- SHARED LOGIC ---
    const shared = {
        doMath: (a, b, op) => {
            try {
                switch(op) {
                    case '+': return a + b;
                    case '-': return a - b;
                    case '*': 
                    case '×': return a * b;
                    case '/': 
                    case '÷': 
                        if (Math.abs(b) < 0.0000001) {
                            showToast("Division by zero");
                            return a;
                        }
                        return a / b;
                    default: return b;
                }
            } catch (err) {
                showToast("Math operation failed");
                return a || 0;
            }
        },

        formatFeetInch: (totalInches, fullDisplay) => {
            const isNeg = totalInches < 0;
            const abs = Math.abs(totalInches);
            
            const feet = Math.floor(abs / 12);
            let rem = abs - (feet * 12);
            const inch = Math.floor(rem);
            
            let frac = rem - inch;
            // Use current accuracy for rounding
            let numerator = Math.round(frac * STATE.accuracy);

            if (numerator === STATE.accuracy) {
                inch++;
                numerator = 0;
            }
            const finalFeet = feet + Math.floor(inch / 12);
            const finalInch = inch % 12;

            let fracString = '';
            if (numerator > 0) {
                const div = gcd(numerator, STATE.accuracy);
                const num = numerator / div;
                const den = STATE.accuracy / div;
                fracString = ` ${num}/${den}`;
            }

            let str = isNeg ? "- " : "";
            str += `${finalFeet}' ${finalInch}"`;
            str += fracString;
            
            return str;
        },

        setOp: (op) => {
            if (STATE.mode === 'normal') {
                norm.setOp(op);
                return;
            }
            
            STATE.currentDisplayUnit = 'inches';
            const currentVal = fi.getTotalInches();

            if (STATE.fi.storedVal === null) {
                STATE.fi.storedVal = currentVal;
            } else if (!STATE.fi.isNewEntry) {
                const currentOp = STATE.fi.op;
                const res = shared.doMath(STATE.fi.storedVal, currentVal, currentOp);
                
                addToHistory(`${shared.formatFeetInch(STATE.fi.storedVal, true)} ${currentOp} ${shared.formatFeetInch(currentVal, true)} = ${shared.formatFeetInch(res, true)}`);

                STATE.fi.storedVal = res;
                fi.setFromTotalInches(res);
            }
            STATE.fi.op = op;
            STATE.fi.isNewEntry = true;
        },

        calculate: () => {
            if (STATE.mode === 'normal') {
                norm.calc();
                return;
            }

            if (STATE.fi.op && STATE.fi.storedVal !== null) {
                const currentOp = STATE.fi.op;
                const valA = STATE.fi.storedVal;
                const valB = fi.getTotalInches();
                const res = shared.doMath(valA, valB, currentOp);
                
                // Add to history
                addToHistory(`${shared.formatFeetInch(valA, true)} ${currentOp} ${shared.formatFeetInch(valB, true)} = ${shared.formatFeetInch(res, true)}`);
                
                STATE.fi.storedVal = null;
                STATE.fi.op = null;
                STATE.fi.isNewEntry = true;
                STATE.lastResult = res;
                
                fi.setFromTotalInches(res);
                fi.updateDisplay();
            }
        },

        clearEntry: () => {
            if (STATE.mode === 'normal') {
                STATE.norm.current = '0';
                norm.updateDisplay();
            } else {
                fi.resetInput();
                STATE.fi.isNewEntry = true;
                STATE.currentDisplayUnit = 'inches';
                fi.updateDisplay();
            }
        },

        clearAll: () => {
            fi.resetInput();
            STATE.fi.storedVal = null;
            STATE.fi.op = null;
            STATE.fi.isNewEntry = true;
            STATE.currentDisplayUnit = 'inches';
            
            norm.clear();
            STATE.memory = 0;
            STATE.undoStack = [];
            STATE.calcHistory = [];
            
            fi.updateDisplay();
            updateHistoryDisplay();
            showToast("All cleared");
        },

        copy: () => {
            const text = els.display.textContent;
            navigator.clipboard.writeText(text).then(() => {
                showToast("Copied: " + text);
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showToast("Copied: " + text);
            });
        },

        undo: () => {
            if (STATE.undoStack.length > 0) {
                const prevState = STATE.undoStack.pop();
                STATE.fi.feet = prevState.feet;
                STATE.fi.inch = prevState.inch;
                STATE.fi.fracNum = prevState.fracNum;
                STATE.fi.fracDen = prevState.fracDen;
                STATE.fi.isNeg = prevState.isNeg;
                fi.updateDisplay();
                showToast("Undo successful");
            } else {
                showToast("Nothing to undo");
            }
        }
    };

    // --- MEMORY FUNCTIONS ---
    const mem = {
        recall: () => {
            if (STATE.mode === 'normal') {
                STATE.norm.current = STATE.memory.toString();
                norm.updateDisplay();
            } else {
                fi.setFromTotalInches(STATE.memory);
                fi.updateDisplay();
            }
            showToast("Memory recalled: " + STATE.memory);
        },

        clear: () => {
            STATE.memory = 0;
            showToast("Memory cleared");
        },

        add: () => {
            let current;
            if (STATE.mode === 'normal') {
                current = parseFloat(STATE.norm.current);
            } else {
                current = fi.getTotalInches();
            }
            STATE.memory += current;
            showToast("Memory +: " + current);
        },

        sub: () => {
            let current;
            if (STATE.mode === 'normal') {
                current = parseFloat(STATE.norm.current);
            } else {
                current = fi.getTotalInches();
            }
            STATE.memory -= current;
            showToast("Memory -: " + current);
        }
    };

    // --- CONVERSION FUNCTIONS ---
    const conv = {
        toMM: () => {
            const inches = fi.getTotalInches();
            const mm = inches * 25.4;
            els.display.textContent = mm.toFixed(4) + ' mm';
            els.subDisplay.textContent = shared.formatFeetInch(inches, false);
            showToast("Converted to millimeters");
        },

        toCM: () => {
            const inches = fi.getTotalInches();
            const cm = inches * 2.54;
            els.display.textContent = cm.toFixed(4) + ' cm';
            els.subDisplay.textContent = shared.formatFeetInch(inches, false);
            showToast("Converted to centimeters");
        },

        toM: () => {
            const inches = fi.getTotalInches();
            const m = inches * 0.0254;
            els.display.textContent = m.toFixed(6) + ' m';
            els.subDisplay.textContent = shared.formatFeetInch(inches, false);
            showToast("Converted to meters");
        },

        toFIF: () => {
            const currentText = els.display.textContent;
            let inches = 0;

            // Try to parse current display value
            if (currentText.includes('mm')) {
                inches = parseFloat(currentText) / 25.4;
            } else if (currentText.includes('cm')) {
                inches = parseFloat(currentText) / 2.54;
            } else if (currentText.includes('m')) {
                inches = parseFloat(currentText) / 0.0254;
            } else if (currentText.includes('ft')) {
                inches = parseFloat(currentText) * 12;
            } else if (currentText.includes('"')) {
                // Already in feet-inch format
                return;
            } else {
                // Assume it's a decimal number in feet
                inches = parseFloat(currentText) * 12;
            }

            fi.setFromTotalInches(inches);
            fi.updateDisplay();
            showToast("Converted to Feet-Inch-Fraction");
        },

        directConvert: () => {
            const value = parseFloat(els.directValue.value);
            const from = els.fromUnit.value;
            const to = els.toUnit.value;

            if (isNaN(value)) {
                els.directResult.textContent = 'Invalid value';
                return;
            }

            // Convert everything to inches first
            let inches = 0;
            switch(from) {
                case 'mm': inches = value / 25.4; break;
                case 'cm': inches = value / 2.54; break;
                case 'm': inches = value / 0.0254; break;
                case 'ft': inches = value * 12; break;
                case 'in': inches = value; break;
                case 'fif': 
                    // Parse feet-inch-fraction format
                    const match = value.toString().match(/(-?\d+)'\s*(\d+)"?\s*(\d+\/\d+)?/);
                    if (match) {
                        inches = parseInt(match[1]) * 12 + parseInt(match[2]);
                        if (match[3]) {
                            const frac = match[3].split('/');
                            inches += parseInt(frac[0]) / parseInt(frac[1]);
                        }
                    } else {
                        inches = value; // fallback
                    }
                    break;
            }

            // Convert from inches to target unit
            let result = 0;
            let resultText = '';
            switch(to) {
                case 'mm': result = inches * 25.4; resultText = result.toFixed(4) + ' mm'; break;
                case 'cm': result = inches * 2.54; resultText = result.toFixed(4) + ' cm'; break;
                case 'm': result = inches * 0.0254; resultText = result.toFixed(6) + ' m'; break;
                case 'ft': result = inches / 12; resultText = result.toFixed(6) + ' ft'; break;
                case 'in': resultText = result.toFixed(4) + ' in'; break;
                case 'fif': resultText = shared.formatFeetInch(inches, false); break;
            }

            els.directResult.textContent = resultText;
        }
    };

    // --- KEYBOARD SUPPORT ---
    document.addEventListener('keydown', (event) => {
        const key = event.key;
        const activeElement = document.activeElement;
        
        // Don't process keyboard events when typing in input fields
        if (activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 'SELECT')) {
            return;
        }

        // Number keys
        if (key >= '0' && key <= '9') {
            if (STATE.mode === 'normal') {
                norm.append(key);
            } else {
                // For feet-inch mode, we need to determine where to send the number
                // This is simplified - you might want to enhance this
                if (event.shiftKey) {
                    fi.appendFeet(parseInt(key));
                } else {
                    fi.appendInch(parseInt(key));
                }
            }
        }
        
        // Decimal point
        else if (key === '.') {
            if (STATE.mode === 'normal') {
                norm.append('.');
            }
        }
        
        // Operators
        else if (['+', '-', '*', '/'].includes(key)) {
            shared.setOp(key);
        }
        
        // Equals
        else if (key === 'Enter' || key === '=') {
            shared.calculate();
        }
        
        // Clear
        else if (key.toLowerCase() === 'c') {
            shared.clearAll();
        }
        
        // Backspace
        else if (key === 'Backspace') {
            if (STATE.mode === 'normal') {
                norm.backspace();
            } else {
                // Simplified - you might want to enhance this
                if (event.shiftKey) {
                    fi.backspaceFeet();
                } else {
                    fi.backspaceInch();
                }
            }
        }
        
        // Escape
        else if (key === 'Escape') {
            shared.clearEntry();
        }
        
        // Prevent default for calculator keys
        if (['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '.', '+', '-', '*', '/', '=', 'Enter', 'c', 'C', 'Backspace', 'Escape'].includes(key)) {
            event.preventDefault();
        }
    });

    // --- WEBSITE FUNCTIONS ---
    function performSearch(query) {
        if (!query.trim()) return;
        console.log('Searching for:', query);
    }

    function showLoginModal() {
        document.getElementById('loginModal').classList.remove('hidden');
    }

    function hideLoginModal() {
        document.getElementById('loginModal').classList.add('hidden');
    }

    function handleLogin(event) {
        event.preventDefault();
        console.log('Login attempt');
        hideLoginModal();
    }

    function logout() {
        console.log('Logout');
    }

    // --- INITIALIZATION ---
    function init() {
        updateHistoryDisplay();
        fi.updateDisplay();
        
        // Set up initial accuracy button state
        els.accuracyButtons[STATE.accuracy].classList.add('active');
        
        // Add touch feedback for mobile
        document.querySelectorAll('button').forEach(btn => {
            btn.addEventListener('touchstart', function() {
                this.style.transform = 'translateY(1px)';
            });
            
            btn.addEventListener('touchend', function() {
                this.style.transform = 'translateY(0)';
            });
        });

        // Initialize Lucide icons
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
    }

    // Start the calculator
    init();
</script>

</body>
</html>